<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AURASPEED Analyzer</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f9f9f9;
      color: #222;
      padding: 40px 20px;
      max-width: 850px;
      margin: auto;
    }
    h1 {
      font-size: 28px;
      margin-bottom: 5px;
    }
    p.tagline {
      font-size: 15px;
      color: #666;
      margin-bottom: 25px;
    }
    textarea {
      width: 100%;
      height: 140px;
      padding: 15px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-bottom: 20px;
      resize: vertical;
    }
    button {
      padding: 12px 24px;
      font-size: 16px;
      background-color: #F24822;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      opacity: 0.9;
    }
    .section {
      background: #fff;
      padding: 20px;
      margin-top: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .section h2 {
      font-size: 20px;
      margin-bottom: 12px;
    }
    .section ul {
      padding-left: 20px;
      margin-top: 0;
    }
    .section ul li {
      margin-bottom: 8px;
    }
    .error {
      color: #c00;
      font-weight: bold;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>AURASPEED ANALYZER</h1>
  <p class="tagline">Paste your headline, script, or idea — this tool will extract meaning, suggest improvements, and give you a strategic edge.</p>

  <textarea id="text" placeholder="Enter your YouTube script, video idea, or headline..."></textarea>
  <button onclick="analyze()">Analyze</button>

  <div id="result" class="section" style="display:none;"></div>
  <div id="error" class="error"></div>

  <script>
    async function analyze() {
      const text = document.getElementById("text").value.trim();
      const resultEl = document.getElementById("result");
      const errorEl = document.getElementById("error");

      if (!text) {
        errorEl.textContent = "Please enter some text to analyze.";
        resultEl.style.display = "none";
        return;
      }

      resultEl.innerHTML = "Analyzing...";
      resultEl.style.display = "block";
      errorEl.textContent = "";

      try {
        const response = await fetch("/api/analyze", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ text })
        });

        const data = await response.json();

        if (!data.ok) {
          errorEl.textContent = "Error: " + (data.error || "Something went wrong.");
          resultEl.style.display = "none";
          return;
        }

        const cleanCap = (text) =>
          text
            .split(" ")
            .map(w => w.charAt(0).toUpperCase() + w.slice(1))
            .join(" ");

        const entities = (data.response.entities || []).filter(e => e.matchedText);
        const topics = data.response.topics || [];

        const uniqueTags = [...new Set([
          ...entities.map(e => e.matchedText.toLowerCase()),
          ...topics.map(t => t.label.toLowerCase())
        ])];

        const filteredTags = uniqueTags
          .filter(tag => tag.length < 35 && !tag.includes("abs-cbn") && !tag.includes("philippine"))
          .slice(0, 10)
          .map(tag => "#" + tag.replace(/\s+/g, '_'))
          .join(', ');

        const titleSuggestions = uniqueTags.slice(0, 3).map((tag, index) => {
          const clean = cleanCap(tag);
          const ideas = [
            `What Happened to ${clean}?`,
            `The Untold Truth About ${clean}`,
            `${clean}: The Legacy Behind the Name`,
            `Why ${clean} Still Matters Today`,
            `The Rise and Fall of ${clean}`
          ];
          return ideas[index % ideas.length];
        });

        const tone = entities.length > 0 ? "Reflective / Historical" : "Neutral";

        const topEntities = entities.slice(0, 5).map(e => cleanCap(e.matchedText));
        const summary = topEntities.length > 0
          ? `This passage reflects on key elements such as ${topEntities.join(", ")}, offering context that may relate to historical moments, figures, or movements.`
          : "We couldn’t extract any meaningful concepts from the submitted text.";

        resultEl.innerHTML = `
          <div class="section">
            <h2>Key Elements Found</h2>
            <ul>
              ${entities.length ? entities.slice(0, 6).map(e => `
                <li><strong>${cleanCap(e.matchedText)}</strong> — Type: ${e.type?.join(', ') || 'Unknown'}, Confidence: ${e.confidenceScore?.toFixed(2)}</li>
              `).join('') : '<li>No recognizable entities found.</li>'}
            </ul>
          </div>

          <div class="section">
            <h2>Auto Tags</h2>
            <p>${filteredTags || 'No tags generated.'}</p>
          </div>

          <div class="section">
            <h2>Title Suggestions</h2>
            <ul>
              ${titleSuggestions.map(t => `<li>${t}</li>`).join('')}
            </ul>
          </div>

          <div class="section">
            <h2>Tone</h2>
            <p>${tone}</p>
          </div>

          <div class="section">
            <h2>Summary</h2>
            <p>${summary}</p>
          </div>
        `;
      } catch (err) {
        errorEl.textContent = "Error: " + err.message;
        resultEl.style.display = "none";
      }
    }
  </script>
</body>
</html>
